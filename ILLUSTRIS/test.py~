import illustris_python as il
import matplotlib.pyplot as plt
import sys

basePath = './Illustris-1/'
fields = ['SubhaloMass']
subhalos = il.groupcat.loadSubhalos(basePath, 135, fields = fields)
mass_msun = subhalos * 1e10 / 0.704

# Constants: 0: Best Fit, 1: Sigma
SHMratio = [[],[]]
N10 = [0.0351,0.0058]
gamma10 = [0.608, 0.059]
negative_beta10 = [0.826,-0.225]
M10 = [(10**11.590), (10**0.236)]

toolbar_width = (len(mass_msun)/100000)+1
sys.stdout.write("Creating plot [%s]" % (" " * toolbar_width))
sys.stdout.flush()
sys.stdout.write("\b" * (toolbar_width+1)) 

for j in range(0,len(mass_msun)):
	M = mass_msun[j]
	if j % 100000 == 0:
		sys.stdout.write("#")
		sys.stdout.flush()
	for i in range(0,2):
		quantity = M/M10[i]**negative_beta10[i]
		quantity += M/M10[i]**gamma10[i]
		quantity = quantity**-1
		quantity = 2*N10[i]*quantity
		SHMratio[i].append(quantity)

plt.title("Stellar mass to halo ratio in relationship with total stellar mass")
plt.plot(mass_msun, SHMratio[0], 'r', label = 'Best fit')
plt.plot(mass_msun, SHMratio[1], 'b', label = '$\sigma$')
plt.legend()
plt.xscale('log')
plt.yscale('log')
plt.xlabel('Total Mass [$M_\odot$]')
plt.ylabel('Stellar-to-halo mass ratio')
plt.savefig("SHMRatio.png")
print "Figure saved!"
plt.clf()

sys.exit()




